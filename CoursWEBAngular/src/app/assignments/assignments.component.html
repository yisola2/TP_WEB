<main class="container">
  <p>{{titre}}</p>
  <div class="ajouterBtn">
    <a routerLink="/add"><button  class="ajouterBtn" mat-flat-button color="primary">Add Assignment</button></a>
  </div>

  <table mat-table [dataSource]="assignments" class="mat-elevation-z8" *ngIf="assignments.length > 0">
    <!-- Nom -->
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef> Nom </th>
      <td mat-cell *matCellDef="let assignment">{{assignment.name}}</td>
    </ng-container>
    <!-- Auteur -->
    <ng-container matColumnDef="auteur">
      <th mat-header-cell *matHeaderCellDef> Auteur </th>
      <td mat-cell *matCellDef="let assignment">{{assignment.auteur?.nom}}</td>
    </ng-container>
    <!-- Photo élève -->
    <ng-container matColumnDef="photoEleve">
      <th mat-header-cell *matHeaderCellDef> Photo élève </th>
      <td mat-cell *matCellDef="let assignment">
        <img *ngIf="assignment.auteur?.photo" [src]="assignment.auteur.photo" alt="Photo élève" width="40" style="border-radius:50%">
      </td>
    </ng-container>
    <!-- Matière -->
    <ng-container matColumnDef="matiere">
      <th mat-header-cell *matHeaderCellDef> Matière </th>
      <td mat-cell *matCellDef="let assignment">
        <img *ngIf="assignment.matiere?.image" [src]="assignment.matiere.image" alt="Image matière" width="30"> {{assignment.matiere?.nom}}
      </td>
    </ng-container>
    <!-- Note -->
    <ng-container matColumnDef="note">
      <th mat-header-cell *matHeaderCellDef> Note </th>
      <td mat-cell *matCellDef="let assignment">{{assignment.note}}</td>
    </ng-container>
    <!-- Prof -->
    <ng-container matColumnDef="prof">
      <th mat-header-cell *matHeaderCellDef> Prof </th>
      <td mat-cell *matCellDef="let assignment">
        <img *ngIf="assignment.matiere?.prof?.photo" [src]="assignment.matiere.prof.photo" alt="Photo prof" width="30" style="border-radius:50%"> {{assignment.matiere?.prof?.nom}}
      </td>
    </ng-container>
    <!-- Remarques -->
    <ng-container matColumnDef="remarques">
      <th mat-header-cell *matHeaderCellDef> Remarques </th>
      <td mat-cell *matCellDef="let assignment">{{assignment.remarques}}</td>
    </ng-container>
    <!-- Date -->
    <ng-container matColumnDef="date">
      <th mat-header-cell *matHeaderCellDef> Date </th>
      <td mat-cell *matCellDef="let assignment">{{assignment.dueDate | date:'dd/MM/yyyy'}}</td>
    </ng-container>
    <!-- Posted On -->
    <ng-container matColumnDef="postedOn">
      <th mat-header-cell *matHeaderCellDef> Créé le </th>
      <td mat-cell *matCellDef="let assignment">{{assignment.postedOn | date:'dd/MM/yyyy'}}</td>
    </ng-container>
    <!-- Statut -->
    <ng-container matColumnDef="statut">
      <th mat-header-cell *matHeaderCellDef> Statut </th>
      <td mat-cell *matCellDef="let assignment">
        <span [ngClass]="assignment.submitted ? 'submitted' : 'nonsubmitted'">
          <mat-icon color="primary">{{assignment.submitted ? 'check_circle' : 'hourglass_empty'}}</mat-icon>
          {{assignment.submitted ? 'Rendu' : 'À rendre'}}
        </span>
      </td>
    </ng-container>
    <!-- Actions -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef> Actions </th>
      <td mat-cell *matCellDef="let assignment">
        <a [routerLink]="['/assignment', assignment._id]" mat-icon-button title="Détail"><mat-icon>visibility</mat-icon></a>
        <a [routerLink]="['/assignment', assignment._id, 'edit']" mat-icon-button title="Éditer"><mat-icon>edit</mat-icon></a>
        <!-- Suppression à ajouter si besoin -->
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="['name','auteur','photoEleve','matiere','note','prof','remarques','date','postedOn','statut','actions']"></tr>
    <tr mat-row *matRowDef="let row; columns: ['name','auteur','photoEleve','matiere','note','prof','remarques','date','postedOn','statut','actions'];"></tr>
  </table>

  <p *ngIf="assignments.length === 0">No assignments available.</p>

  <mat-divider></mat-divider>
  <mat-paginator 
    [length]="totalAssignments"
    [pageSize]="pageSize"
    [pageSizeOptions]="[5, 10, 20]"
    (page)="onPageChange($event)"
    showFirstLastButtons>
  </mat-paginator>
<!--<app-assignment-detail [assignmentTransmis]="SelectedAssignment"></app-assignment-detail>-->
</main>